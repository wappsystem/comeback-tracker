<div id=D__ID>
	<!--third html start -->
	<div class="container mt-95">
		<!-- form container start -->
		<div class="formbox">
			<!-- form start -->
			<form id="F__ID">
				<span id=title__ID></span>
				<!-- form-design name and study id -->
				<div class="formgroup">
					<fieldset class="">
						<div class="grid-container-2">
							<div>
								<label><span class="question">Formula ID</span>
									<input type=text id="record__ID" class=formcontrol readonly />
								</label>
							</div>
							<div>
								<label><span class="question">Formula Name </span>
									<input type=text name="Formula_Name" class="formcontrol width_80" />
								</label>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="formgroup">
					<fieldset class="">
						<div class="grid-container-3">
							<div>
								<label><span class="question">ID</span>
									<input type=text name="Name_ID" class="formcontrol" readonly />
								</label>
							</div>
							<div>
								<label><span class="question">Who took the Formula</span>
									<input type=text id=Name_first__ID name="First_Name" class="formcontrol width_80" />
								</label>
							</div>
							<div>
								<label><span class="question">Scan Entry Time</span>
									<input type=text name="Scan_Entry_Time" class="formcontrol width_80" />
								</label>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="formgroup" style="background-color: lightgreen;">
					<fieldset class="">
						<div class="grid-container-4">
							<div>
								<label><span class="question">Product Name</span>
									<input type=text id="Product_Name__ID" class="formcontrol threeqwidth" />
								</label>
							</div>
							<div>
								<label><span class="question">Products ID</span>
									<input type=text id="Product_uid__ID" class="formcontrol threeqwidth" readonly />
								</label>
							</div>
							<div>
								<label><span class="question">Format</span>
									<input type=text id="Format__ID" class="formcontrol threeqwidth" readonly />
								</label>
							</div>
							<div id="convers__ID" style="display:none">
								<div style="display:none">
									<input type=text id="Tsp_to_mg__ID"/>
								</div>
								<div>
									<label><span class="question">Conversion</span>
										<p class="" id="conversion__ID"></p>
									</label>
								</div>
							</div>
						</div>
						<div class="grid-container-3">
							<div>
								<label><span class="question">Size</span>
									<input type=text id="Size__ID" class="formcontrol threeqwidth" readonly />
								</label>
							</div>
							<div>
								<label><span class="question">Supplier</span>
									<input type=text id="Supplier__ID" class="formcontrol threeqwidth" readonly />
								</label>
							</div>
							<div>
								<label><span class="question">Locattion FS</span>
									<input type=text id="Location_FS__ID" class="formcontrol threeqwidth" readonly />
								</label>
							</div>
						</div>
						<div class="grid-container-3" >
							<div>
								<label><span class="question" >Add Product to  the Formula</span>
								<span style='cursor:pointer;padding:2px 0' id=item_a_add__ID class="rd_btn width_btn_full textcenter">Add Product</span>
								</label>
								<!--<label><span class="question">Ingredients</span></label><br>
								<u style='cursor:pointer;' id=item_a_add__ID><i class="fa fa-plus"></i> <span >Add line per ingredient</span></u>-->
							</div>
							<div>
								<label><span class="question" id="quantity_label__ID">Quantity</span>
									<input type="text" id="Quantity__ID" class="formcontrol" />
								</label>
							</div>
							<div id="select_tbsp__ID">
								<label><span class="question" id="select_powder_label__ID">Select Measurement</span>
									<input type="text" id="select_powder__ID" class="formcontrol" />
								</label>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="formgroup">
					<table id=grid_item_a__ID></table>
				</div>
				<!--<div class="formgroup">
					<fieldset class="">
						<div class="grid-container-2">
							<div><label><span class="question">Date</span>
									<input type=date name="Date" class='formcontrol width_80' />
								</label>
							</div>
								<div><label><span class="question">Time </span>
										<input type=text name="Time" class="formcontrol width_80" />
									</label>
								</div>
							</div>
					</fieldset>
				</div>-->
				<div class="formgroup" style="display:none">
					<fieldset class="">
						<div class="grid-container-1">
							<div>
								<label><span class="question">Input Type</span>
									<select name="Input_type" class="formcontrol">
										<option></option>
										<option>Manual</option>
										<option>Scanned</option>
									</select>
								</label>
							</div>
						</div>
					</fieldset>
				</div>

				<div class="formgroup right">
					<button type="submit" id="submit__ID" class="btn">Submit</button>
				</div>
			</form>
		</div>
	</div>
	<script>
		function F__ID() {
			//-------------------------------------
			VmInclude: '__HOST__/assets/js/form.01.js'
			VmInclude: '__HOST__/assets/js/form-item-a.01.js'
			//-------------------------------------
			var load = m.load;
			m.load = function () {
				load();	
				//-------------------------------------
				/*if(m.input.record==undefined) {
					var currentdate = new Date();
					$("#F__ID input[name='Date']").val(currentdate.getFullYear() +"-"+(((currentdate.getMonth()+1) < 10)?"0":"") + (currentdate.getMonth()+1) +"-"+((currentdate.getDate() < 10)?"0":"") + currentdate.getDate());
					$("#F__ID input[name='Time']").val(((currentdate.getHours() < 10)?"0":"") + currentdate.getHours() +":"+ ((currentdate.getMinutes() < 10)?"0":"") + currentdate.getMinutes() +":"+ ((currentdate.getSeconds() < 10)?"0":"") + currentdate.getSeconds());
				}*/
				//-------item a part
				m.item_a_records=[]; 
				if(m.input.record!=undefined) m.item_a_records=m.input.record.Data.items_a;
				//console.log("AAA"+JSON.stringify(m.input.record))
				m.item_a_render();
				//-------item a part
			}
            //----------------------------------
            //item a part
            m.item_a_fields="Product,P_ID,Format,Tsp_to_mg,Quantity,_Remove";
            //----------------------------------
            $('#item_a_add__ID').on('click',function(){ m.item_a_add_product();m.item_a_cell_render(); })
            //----------------------------------
			m.item_a_add_product=function(){
				console.log("ADD")
				var new_records;
				var new_row={}
				for(var i=0;i<m.item_a_field_id.length;i++){
					var b=m.item_a_field_id[i];
					switch (b){
						case "Product": 
						new_row['Product']=$("#F__ID #Product_Name__ID").val();
						break;
						case "P_ID": 
						new_row['P_ID']=$("#F__ID #Product_uid__ID").val();
						break;
						case "Format": 
						new_row['Format']=$("#F__ID #Format__ID").val();
						break;
						case "Tsp_to_mg": 
						new_row['Tsp_to_mg']=$("#F__ID #Tsp_to_mg__ID").val();
						break;
						case "Quantity": 
						new_row['Quantity']=$("#F__ID #Quantity__ID").val();
						break;
					}
				}
				m.item_a_records.splice(m.item_a_records.length, 0, new_row);
				m.item_a_render(m.item_a_records.length);
			};
			//----------------------------------
            m.item_a_cell_render=function(records,I,field,td,set_value,source){
            }
            //----------------------------------
            m.item_a_after_change = function (records, I, field, td, set_value, source) {
				//console.log("after change: "+JSON.stringify(records))
			}
            //----------------------------------
            m.item_a_after_remove=function(){
                //cal();
            }
            //----------------------------------
                
			m.before_submit = function (data, index) {
				data.Input_type="Manual"
				//console.log(JSON.stringify(data))
				//console.log(JSON.stringify(index))
				if(m.item_a_records!=undefined) data.items_a = m.item_a_get_data();
				//console.log(JSON.stringify(data))
				//Sort Product ID in order for easier search
				var prod=[];
				for (var i=0;i<data.items_a.length;i++){
					prod.push(parseInt(data.items_a[i].P_ID))
				}
				prod.sort(function(a, b) {return a - b;});
				//console.log(JSON.stringify(prod))
				index.I2=JSON.stringify(prod);
			}
			//-------------------------------------
			//auto select client
			var get_name = function (record) {
				var name = record.Data.First_Name;
				return name;
			}
			var get_client_info = function (record) {
				var name = record.Data.First_Name;
				return name;
			}
			var autocomplete_req_1 = { cmd: "find", field: ".I1", table: m.client2_table, options: {}, skip: 0, limit: 10 }
			var autocomplete_callback_1 = function (items) { $("#F__ID input[name=Name_ID]").val(items["UID"]); $("#F__ID input[name=First_Name]").val(get_client_info(items.record)); }
			var autocomplete_list_1 = function (records) {
				var items = [];
				for (var i = 0; i < records.length; i++) {
					var obj = {};
					obj.label = get_name(records[i]);
					obj['UID'] = records[i].UID;
					obj['record'] = records[i];
					items.push(obj);
				}
				return items;
			}
			var wait1 = function () {
				$vm.autocomplete($('#Name_first__ID'), autocomplete_req_1, autocomplete_list_1, autocomplete_callback_1);
			}
			var I = 0; var loop_1 = setInterval(function () {
				if ($vm['jquery-ui-min-js'] != undefined) { clearInterval(loop_1); wait1(); }
				I++; if (I > 50) { clearInterval(loop_1); alert("jquery-ui.min.js is not installed."); }
			}, 100);

			//-------------------------------------wait_2
			//auto select client
			var get_name_2 = function (record) {
				var name = record.Data.Product_Name;
				return name;
			}
			var get_client_info_2 = function (record) {
				var name = record.Data.Product_Name
				return name;
			}
			var autocomplete_req_2 = { cmd: "find", field: ".I2", table: m.client_table, options: {}, skip: 0, limit: 10 }
			var autocomplete_callback_2 = function (items) {
				console.log("autocomplete_callback_2");
				//console.log(JSON.stringify(items));
				$("#F__ID #Product_uid__ID").val(items["UID"]);
				$("#F__ID #Product_Name__ID").val(get_client_info_2(items.record));
				$("#F__ID #Format__ID").val(items.record.Data.Format);
				$("#F__ID #conversion__ID").text("1 tsp = "+items.record.Data.Tsp_to_mg+" mg");
				$("#F__ID #Tsp_to_mg__ID").val(items.record.Data.Tsp_to_mg);
				$("#F__ID #Size__ID").val(items.record.Data.Size);
				$("#F__ID #Supplier__ID").val(items.record.Data.Supplier);
				$("#F__ID #Location_FS__ID").val(items.record.Data.Location_FS);
				conversion=parseFloat(items.record.Data.Tsp_to_mg);
				if(items.record.I3=="Powder") {$("#F__ID #convers__ID").show();$("#F__ID #select_tbsp__ID").show();$("#F__ID #Quantity__ID").prop('readonly',true);}
				else {$("#F__ID #convers__ID").hide();$("#F__ID #select_tbsp__ID").hide();$("#F__ID #Quantity__ID").prop('readonly',false);}
				//console.log(JSON.stringify(items.record));
			}
			var autocomplete_list_2 = function (records) {
				console.log("auto_2")
				var items = [];
				for (var i = 0; i < records.length; i++) {
					var obj = {};
					obj.label = get_name_2(records[i]);
					obj['UID'] = records[i].UID;
					obj['record'] = records[i];
					items.push(obj);
				}
				return items;
			}
			var wait2 = function () {
				console.log("wait_2")
				$vm.autocomplete($('#Product_Name__ID'), autocomplete_req_2, autocomplete_list_2, autocomplete_callback_2);
			}
			var I = 0; var loop_2 = setInterval(function () {
				console.log("loop");
				if ($vm['jquery-ui-min-js'] != undefined) { clearInterval(loop_2); wait2(); }
				I++; if (I > 50) { clearInterval(loop_2); alert("jquery-ui.min.js is not installed."); }
			}, 100);
			//-------------------------------------
			//auto select predefined measurement
			var autocomplete_req_3={cmd:"find",field:'.I1',table:m.measurement_table2,options:{},skip:0,limit:10}
			var autocomplete_callback_3=function(items){
				console.log(JSON.stringify(items)) 
				var decimals=0;
				if($('#F__ID #Format__ID').val()=="Powder"){
					decimals=3
					$('#F__ID #Quantity__ID').val((conversion*parseFloat(items.datax.Value)/1000).toFixed(decimals));
				}
				else{
					$('#F__ID #Quantity__ID').val((conversion*parseFloat(items.datax.Value)).toFixed(decimals));
				}
				//update_stock();
			}
			var autocomplete_list_3=function(records){
				console.log("auto_3")
				var items=[];
				console.log(JSON.stringify(records))
				for(var i=0;i<records.length;i++){
					var obj={};
					obj.datax=records[i].Data;
					obj.label=records[i].Data.Measurement;
					items.push(obj);
				}
				return items;
			}
			var wait3=function(){
				//console.log("wait_3")
				$vm.autocomplete($('#select_powder__ID'),autocomplete_req_3,autocomplete_list_3,autocomplete_callback_3);
			}
			var I=0; var loop_3=setInterval(function (){
				if($vm['jquery-ui-min-js']!=undefined){  clearInterval(loop_3); wait3(); }
				I++; if(I>50){ clearInterval(loop_3); alert("jquery-ui.min.js is not installed."); }
			},100);
		}
	</script>
	<style>
		/*VmInclude: '__HOST__/assets/css/form-item-a.01.css'*/
		/*VmInclude:__HOST__/assets/css/wapp-form.css*/
	</style>
</div>